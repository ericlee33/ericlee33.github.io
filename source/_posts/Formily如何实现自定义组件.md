---
title: Formilyå¦‚ä½•å®ç°è‡ªå®šä¹‰ç»„ä»¶
date: 2021-05-28 13:02:39
tags:
---
>æ³¨ï¼šæœ¬æ–‡ä½¿ç”¨çš„Formilyä¸ºv1ç‰ˆæœ¬ï¼Œ21å¹´4æœˆä¸­æ—¬é˜¿é‡Œå›¢é˜Ÿå·²ç»æ¨å‡ºv2ç‰ˆæœ¬ https://v2.formilyjs.org/ ï¼Œä½†æ˜¯è·¨åº¦éå¸¸å¤§ï¼Œä¸º`Breaking change`ï¼Œç›¸å½“äºæ¡†æ¶åº•å±‚å®Œå…¨é‡æ„ï¼Œå¯¹äºv1ç‰ˆæœ¬çš„é¡¹ç›®æ¥è¯´è¿ç§»æˆæœ¬éå¸¸å¤§ã€‚

## èƒŒæ™¯
### Formilyæ˜¯ä»€ä¹ˆï¼Ÿ
https://formilyjs.org/#/bdCRC5/dzUZU8il
è¿™é‡Œå¼•ç”¨å®˜ç½‘çš„æè¿°ï¼š
**Formily æ˜¯ä¸€ä¸ªç”±é˜¿é‡Œå·´å·´é›†å›¢å¤šéƒ¨å…±å»ºçš„é¢å‘ä¸­åå°å¤æ‚åœºæ™¯çš„è¡¨å•è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªè¡¨å•æ¡†æ¶ã€‚**
### Formilyå®ç°äº†ä»€ä¹ˆï¼Ÿ
- åœ¨å¤æ‚è”åŠ¨åœºæ™¯ä¸‹æ›´åŠ æ¸…æ™°ç®€å•çš„æè¿°è”åŠ¨çš„æ–¹å¼
- åœ¨è¶…å¤šè¡¨å•é¡¹åœºæ™¯ä¸‹å¯ä»¥è·å¾—æ›´å¥½çš„è¡¨å•æ“ä½œæ€§èƒ½
- åœ¨è·¨ç»ˆç«¯åœºæ™¯ä¸‹å®ç°é€šç”¨è¡¨å•è§£å†³æ–¹æ¡ˆ


### Formilyç»„ä»¶è¯´æ˜
`Formily v1`æä¾›ç»™äº†æˆ‘ä»¬3ç§`React`çš„`UI`æ¡†æ¶

ä»¥ä¸‹è¿™äº›`UI`æ¡†æ¶ç»è¿‡`formily`çš„äºŒæ¬¡å°è£…ï¼ŒUIç»„ä»¶ç»è¿‡å°è£…åï¼Œå®Œç¾å…¼å®¹äº†`Formily`

3ç§`UI`æ¡†æ¶åˆ†åˆ«ä¸ºï¼š
- `Antd`
- `Next`
- `Meet`


[ğŸ˜Š Antdçš„Formily APIæ–‡æ¡£](https://formilyjs.org/#/zoi8i0/6dt3t7FjI4)


å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰ä»‹ç»åŸºäº`JSON Schema`ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶çš„æ–¹æ³•ï¼Œä½†æ˜¯ç»™å‡ºäº†
1.åŸºäº`JSX`è¡¨å•çš„è‡ªå®šä¹‰ç»„ä»¶åˆ¶ä½œæ–¹æ³•ï¼Œ [ç†è§£è¡¨å•æ‰©å±•æœºåˆ¶](https://formilyjs.org/#/0yTeT0/vVSBSNhmHr)ï¼ˆè™½ç„¶æ–‡æ¡£ä¾æ—§æ¬ ç¼ºï¼Œä¸è¿‡åº“çš„`TypeScript`çš„ç±»å‹åšçš„è¿˜ç®—å¾ˆä¸é”™çš„ï¼Œç›¸å½“äºä¸€ä»½æ–‡æ¡£å§ï¼‰
2.[å®ç°è¶…å¤æ‚è‡ªå®šä¹‰ç»„ä»¶](https://formilyjs.org/#/0yTeT0/A1T4TPhXUZ)ï¼Œä½†æ˜¯è¯¥æ–‡æ¡£å¹¶ä¸æ˜¯å¾ˆå®ç”¨ï¼Œç”±äºæˆ‘ä»¬æ˜¯`JSON Schema`å¼€å‘æ¨¡å¼ï¼Œç”¨`useFromEffects`æ¥æ§åˆ¶`state`æ˜¾ç„¶ä¸ç°å®

## åˆ¶ä½œè‡ªå®šä¹‰ç»„ä»¶
>è¿™é‡Œä»¥åŸºäº`Antd`äºŒæ¬¡å°è£…`Radio`ä¸šåŠ¡ç»„ä»¶ä¸¾ä¾‹
### åœ¨å®¹å™¨ä¸­å¼•å…¥è‡ªå®šä¹‰ç»„ä»¶

é¦–å…ˆï¼Œä¸ºäº†ä½¿ç”¨`JSON Schema`æ¨¡å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨`SchemaForm`ç»„ä»¶ã€‚
```jsx
<SchemaForm
    components={components}
    onSubmit={onSubmit}
    expressionScope={createRichTextUtils(history)}
    schema={formData.schema}
    onChange={onCheckCanClickNextStep}
    actions={actions}
    onValidateFailed={onValidateFailed}
>
</SchemaForm>
```
å¯ä»¥æ³¨æ„åˆ°ï¼Œ`props`æœ‰ä¸€ä¸ªå±æ€§ä¸º`components`ï¼Œè¯¥å±æ€§ä»£è¡¨äº†å…¨éƒ¨`JSON Schema`é€šè¿‡`x-component`å¯ä»¥ä½¿ç”¨çš„ç»„ä»¶ä»¬ã€‚

`components`å¯¹è±¡å¦‚ä¸‹ï¼š

```jsx
import CustomRadio from '../../custom-components/CustomRadio/CustomRadio';
import 'xxx' from 'xxx'// æ­¤å¤„çœç•¥å…¶ä»–import.....

const components = {
    /** è‡ªå®šä¹‰ç»„ä»¶ä»¬ */
    CustomRadio,
    // others....
    /** å®˜æ–¹ç»„ä»¶ä»¬ */
    Input,
    Radio: Radio.Group,
    Checkbox: Checkbox.Group,
    TextArea: Input.TextArea,
    NumberPicker,
    Select,
    Switch,
    DatePicker,
    DateRangePicker: DatePicker.RangePicker,
    YearPicker: DatePicker.YearPicker,
    MonthPicker: DatePicker.MonthPicker,
    WeekPicker: DatePicker.WeekPicker,
    TimePicker,
    TimeRangePicker: TimePicker.RangePicker,
    Upload,
    Range,
    Rating,
    Transfer,
    // others....
};
```

æˆ‘ä»¬åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ª`CustomRadio`ï¼Œè‡³æ­¤æˆåŠŸå¼•å…¥äº†ä¸€ä¸ªæˆ‘ä»¬è¦è‡ªå®šä¹‰çš„ç»„ä»¶

### Formily JSON Schemaåè®®è§„èŒƒ
åœ¨çœŸæ­£å¼€å§‹å†™ç»„ä»¶é€»è¾‘ä¹‹å‰ï¼Œä½ éœ€è¦äº†è§£`JSON Schema`çš„`Schema`è§„èŒƒï¼Œè¿™ä¸€éƒ¨åˆ†

å®é™…ä¸Šæ¯”å¦‚`Antd`çš„`Form`ç»„ä»¶ï¼Œå¤§ä½“æ„æˆä¸º

```jsx
<Form>
    <Form.Item
        className="form-item"
        label="test_radio"
        name="test_radio"
        rules={[{ required: true }]}
    >
        <CustomRadio terminalValue={[ 1 ]} />
    </Form.Item>
</Form>
```

é‚£ä¹ˆå¦‚ä½•ç”¨`JSON`å»æè¿°è¿™ä¸€è¡Œä¸ºå‘¢ï¼Ÿ`Formily`çº¦å®šçš„`Schema`å¦‚ä¸‹ï¼š


```json
{
    "type": "object",
    "properties": {
    "test_radio": {
            "key": "test_radio",
            "type": "number",
            "title": "æµ‹è¯•customRadio",
            "name": "test_radio",
            "required": true,
            "enum": [
                {
                    "label": "yes",
                    "value": 1
                },
                {
                    "label": "no",
                    "value": 0
                }
            ],
            "x-props": {
                "itemClassName": "form-item"
            },
            "x-component": "CustomRadio",
            "x-component-props": {
                "terminalValue": [
                    1
                ]
            },
            "default": 1
        },
    }
}
```
ç®€å•è§£é‡Šä¸€ä¸‹ï¼š
`x-props`è¡¨ç¤º`<Form.item />`çš„`props`
`x-component-props`è¡¨ç¤ºè¡¨å•`UI`ç»„ä»¶çš„`props`


### åˆ¶ä½œè¡¨å•ç»„ä»¶

> ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨`Antd`çš„`Radio`ç»„ä»¶åŸºç¡€ä¸Šå°è£…æˆ‘ä»¬çš„ä¸šåŠ¡Radioç»„ä»¶

```jsx
// CustomRadio.jsx
import styles from './CustomRadio.module.scss';
import { Radio } from 'antd';
import { useEffect, useState } from 'react';

export default ({ onChange, terminalValue = [], dataSource = [], value, ...rest }) => {
    const [radioValue, setRadioValue] = useState(value);

    const onChangeRadioGroup = event => {
        const value = event.target?.value;

        /** è§¦å‘ä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å¼¹çª—ï¼Œç­‰ç­‰æ“ä½œ */
        if (terminalValue.includes(value)) {
            // Do things
        }

        setRadioValue(value);
        /** æ”¹å˜SchemaFormå†…éƒ¨value */
        onChange(value);
    };

    return (
        <div className={styles.container}>
            <Radio.Group onChange={onChangeRadioGroup} value={radioValue}>
                {dataSource.map((radio, index) => (
                    <Radio key={index} value={radio.value}>
                        {radio.label}
                    </Radio>
                ))}
            </Radio.Group>
        </div>
    );
};
```
#### Formilyä¸ºç»„ä»¶æ³¨å…¥çš„Propsé¡¹
åœ¨`Formily`æ¡†æ¶ä¸­ï¼Œåœ¨è°ƒç”¨ç»„ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨æ³¨å…¥å‡ ä¸ªå±æ€§
- `onChange`
- `onBlur`
- `onFocus`
- `value`
- `dataSource`
- æˆ‘ä»¬åœ¨`x-component-props`å±‚å®šåˆ¶çš„å±æ€§
è¿˜æœ‰å…¶å®ƒçš„é»˜è®¤å±æ€§ä»¬

| å­—æ®µ | ä½œç”¨ |
| -- | -- |
| onChange | è°ƒç”¨è¯¥æ–¹æ³•æ‰å¯ä»¥çœŸæ­£å¯¹`Form`å®ä¾‹å¯¹è±¡ä¸Šçš„å¯¹åº”`name`è¡¨å•é¡¹çš„`value`è¿›è¡Œä¿®æ”¹ |
| value | å¯¹åº”ç€JSONä¸­çš„`default`å­—æ®µæ”¹ |
| dataSource | æ¯”å¦‚åœ¨Radioä¸­ï¼Œå°±æ˜¯é€šè¿‡JSONæè¿°çš„Enumå€¼ |
| è‡ªå®šä¹‰å±æ€§ | - |


#### æ³¨å…¥ä¸šåŠ¡é€»è¾‘
æˆ‘ä»¬ä¸»åŠ¨å»ç›‘å¬`Radio.Group`çš„`onChange`äº‹ä»¶ï¼Œå½“å…¶`value`å€¼æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬è§¦å‘ç›¸å…³ä¸šåŠ¡é€»è¾‘ã€‚

## ç»“è¯­
è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªæœ€åŸºç¡€çš„ä¸šåŠ¡ç»„ä»¶ã€‚å¦‚æœè¿˜æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ï¼Œå¯ä»¥å‚è€ƒ [ç†è§£è¡¨å•æ‰©å±•æœºåˆ¶](https://formilyjs.org/#/0yTeT0/vVSBSNhmHr) ã€‚

åæ§½ï¼šç®€å•çœ‹äº†ä¸€ä¸‹v2çš„ä»‹ç»ï¼ŒFormilyå®˜æ–¹æ–‡æ¡£ä¸­æè¿°çš„æ„æ€æ˜¯ï¼Œå®˜æ–¹ä¹Ÿæ„è¯†åˆ°äº†v1ç‰ˆæœ¬ç»„ä»¶æ‰©å±•çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨v2ç‰ˆæœ¬å®Œå…¨é‡æ„äº†ã€‚